name: CD

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  buildLinux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build and test
        run: |
          cd Platform.Data.Triplets.Kernel/
          make
          ./run.sh 
        run: |
          export TARGET_PLATFORM="linux-x64"
          export TARGET_PLATFORM_PREFIX="lib"
          export TARGET_PLATFORM_SUFFIX=".so"
          export TRAVIS_REPO_NAME="Data.Triplets.Kernel"
          export SOURCE_BRANCH="master"
      - name: Publish
        run: bash ./publish-binaries.sh
      
  buildWindow:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build and test
        run: |
          cd Platform.Data.Triplets.Kernel/
          ls
          mingw32-make
          ./test 
        run: |
          export TARGET_PLATFORM="win-x64"
          export TARGET_PLATFORM_PREFIX=""
          export TARGET_PLATFORM_SUFFIX=".dll"
          export TRAVIS_REPO_NAME="Data.Triplets.Kernel"
          export SOURCE_BRANCH="master"
      - name: Publish
        run: bash ./publish-binaries.sh

  buildMacOs:
    runs-on: macos-latest 
    steps:
      - uses: actions/checkout@v2
      - name: Build and test
        run: |
          cd Platform.Data.Triplets.Kernel/
          ls
          make
          ./run.sh
        run: |
          export TARGET_PLATFORM="osx-x64"
          export TARGET_PLATFORM_PREFIX="lib"
          export TARGET_PLATFORM_SUFFIX=".dylib"
          export TRAVIS_REPO_NAME="Data.Triplets.Kernel"
          export SOURCE_BRANCH="master"
      - name: Publish
        run: bash ./publish-binaries.sh


